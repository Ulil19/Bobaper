{% extends "/user/layout/layoutuser.html" %}

{% block content %}

<!-- Product Start -->
<div class="produk" id="produk">
  <div class="container-xxl py-5">
    <div class="content-container" style="padding-top: 100px">
      <div class="row g-0 gx-5 align-items-end">
        <div class="col-lg-6">
          <div class="section-header text-start mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px">
            <h1 class="display-5 mb-3">Our Products</h1>
            <p>Bobapeer.id</p>
          </div>
        </div>
      </div>
      <div class="tab-content">
        <div id="tab-1" class="tab-pane fade show p-0 active">
          <div class="row g-4">
            {% for produk in produk %}
            <div class="col-xl-3 col-lg-4 col-md-6 wow fadeInUp" data-wow-delay="0.1s">
              <div class="product-item">
                <div class="position-relative bg-light overflow-hidden">
                  <img class="img-fluid w-100" src="{{ url_for('static', filename='imgproduct/' + produk['foto']) }}" alt=""/>
                  <div class="bg-secondary rounded text-white position-absolute start-0 top-0 m-4 py-1 px-3">New</div>
                </div>
                <div class="text-center p-4">
                  <a class="d-block h5 mb-2" href="">{{ produk['nama'] }}</a>
                  <span class="text-primary me-1">Stok: {{ produk['stock'] }}</span><br/>
                  <span class="text-body me-3">Harga: Rp. {{ '{:,}'.format(produk['harga']) }}</span>
                </div>
                <div class="d-flex border-top justify-content-center">
                  <small class="text-center py-2">
                    <a class="text-body mx-auto add-to-cart" data-id="{{ produk['_id'] }}">
                      <i class="fa fa-shopping-bag text-primary me-2"></i>Add to cart
                    </a>
                  </small>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Product End -->

<!-- Review Section Start -->
<div class="review-section container-xxl py-5" id="reviews">
  <div class="content-container">
    <div class="section-header text-start mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px">
      <h1 class="display-5 mb-3">Our Review</h1>
      <p>Bobapeer.id</p>
    </div>
    <div id="review-content">
      {% for review in reviews %}
      <div class="bg-light p-4 rounded mb-4 shadow-sm">
        <p><strong>{{ review.username }}</strong> ({{ review.created_at }}):</p>
        <div class="rating">
          {% for i in range(1, 6) %}
            {% if i <= review.rating %}
              <span class="fa fa-star checked"></span>
            {% else %}
              <span class="fa fa-star"></span>
            {% endif %}
          {% endfor %}
        </div>
        <p>{{ review.review }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
<!-- Review Section End -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // Add to cart button click event
    $(".add-to-cart").click(function (e) {
      e.preventDefault();

      // Get the product ID
      var productId = $(this).data("id");

      // Send an AJAX request to add the product to the shopping cart
      $.ajax({
        url: "/addshoppingcart",
        type: "POST",
        data: {
          product_id: productId
        },
        success: function (response) {
          alert("Product added to cart!");
          window.location.reload();
        },
        error: function (xhr, status, error) {
          alert("An error occurred: " + error);
        }
      });

    });
  });
</script>

<style>
  .rating {
    display: flex;
  }
  .fa-star {
    font-size: 1.5em;
    color: lightgray;
  }
  .fa-star.checked {
    color: gold;
  }
</style>

{% endblock %}
